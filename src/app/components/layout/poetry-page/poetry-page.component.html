<div class="poetry-page" [class.results-highlight]="recentlyAnalyzed()">
  <app-toast-container />

  <app-header />

  <div class="quick-nav-buttons">
    <button
      class="nav-pill"
      [class.active]="currentSection() === 'editor'"
      (click)="onQuickNav('editor')"
      aria-label="Go to editor"
    >
      <span class="icon-[iconoir--edit-pencil]"></span>
      <span>editor</span>
    </button>

    <button
      class="nav-pill"
      [class.active]="currentSection() === 'results'"
      [disabled]="!hasResults()"
      (click)="onQuickNav('results')"
      aria-label="Go to results"
    >
      <span class="icon-[iconoir--page-search]"></span>
      <span>results</span>
    </button>
  </div>

  <app-panorama>
    <div data-section="editor">
      <div class="section-content">
        <app-poem-editor />

        @if (analyzer.wordAlternatives(); as alternatives) {
          <div class="suggestions-wrapper">
            <app-word-suggestions
              [data]="alternatives"
              (replaceWord)="onReplaceWord($event)"
              (closeSuggestions)="onCloseSuggestions()"
            />
          </div>
        }

        <div class="info-section">
          <div class="info-content">
            <span class="icon-[iconoir--light-bulb] info-icon"></span>
            <div class="info-text">
              <h4 class="info-title">how it works</h4>
              <p class="info-description">
                Harawihark uses advanced phonetic analysis to count syllables accurately, detect
                rhyme schemes, and provide intelligent suggestions.
              </p>
              <ul class="info-features">
                <li>
                  <span class="icon-[iconoir--sound-high] feature-icon"></span>
                  Real-time syllable counting with RiTa.js
                </li>
                <li>
                  <span class="icon-[iconoir--music-note] feature-icon"></span>
                  Advanced meter analysis (iambic, trochaic, etc.)
                </li>
                <li>
                  <span class="icon-[iconoir--star] feature-icon"></span>
                  Quality assessment with detailed metrics
                </li>
                <li>
                  <span class="icon-[iconoir--book-stack] feature-icon"></span>
                  8 different poetic forms supported
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div data-section="results" [class.section-highlight]="recentlyAnalyzed()">
      <div class="section-content">
        @if (hasResults()) {
          @if (isAnalyzing()) {
            <app-card padding="large">
              <div class="analysis-loading">
                <div class="analysis-stages">
                  <div class="stage" [class.active]="currentStage() === 'syllables'">
                    <span class="icon-[iconoir--sound-high] stage-icon"></span>
                    <span class="stage-label">counting syllables</span>
                    @if (currentStage() === 'syllables') {
                      <app-progress type="bar" />
                    }
                  </div>

                  <div class="stage" [class.active]="currentStage() === 'rhythm'">
                    <span class="icon-[iconoir--music-note] stage-icon"></span>
                    <span class="stage-label">analyzing rhythm</span>
                    @if (currentStage() === 'rhythm') {
                      <app-progress type="bar" />
                    }
                  </div>

                  <div class="stage" [class.active]="currentStage() === 'patterns'">
                    <span class="icon-[iconoir--sparks] stage-icon"></span>
                    <span class="stage-label">detecting patterns</span>
                    @if (currentStage() === 'patterns') {
                      <app-progress type="bar" />
                    }
                  </div>
                </div>
              </div>
            </app-card>
          } @else {
            <app-pivot
              [items]="analysisTabs()"
              [selectedId]="selectedAnalysisTab()"
              (selectedChange)="onAnalysisTabChange($event)"
            />

            <div class="analysis-content">
              @switch (selectedAnalysisTab()) {
                @case ('structure') {
                  <app-poem-results
                    [result]="analyzer.result()!"
                    (wordSelected)="onWordSelected($event)"
                  />
                }
                @case ('rhythm') {
                  <app-meter-analysis-section [result]="analyzer.result()!" />
                }
                @case ('quality') {
                  @if (analyzer.qualityMetrics()) {
                    <app-poem-quality [metrics]="analyzer.qualityMetrics()!" />
                  } @else {
                    <app-card padding="large">
                      <div class="quality-prompt">
                        <span class="icon-[iconoir--star] text-4xl mb-4"></span>
                        <p class="text-base mb-6 text-onSurfaceVariant">
                          Select the Quality tab to see detailed quality metrics
                        </p>
                      </div>
                    </app-card>
                  }
                }
                @case ('stats') {
                  <app-quick-stats-panel [stats]="getQuickStats()" />
                }
              }
            </div>

          }
        } @else {
          <app-card padding="large">
            <div class="empty-state-rich">
              <span class="icon-[iconoir--flower] empty-icon"></span>
              <h3 class="empty-title">ready to analyze poetry</h3>
              <p class="empty-description">
                Write your poem in the editor or load an example to see analysis
              </p>

              <div class="forms-showcase">
                <h4 class="forms-title">try these poetic forms:</h4>
                <div class="forms-grid">
                  <button class="form-card" (click)="loadFormExample('haiku')">
                    <span class="form-name">haiku</span>
                    <span class="form-pattern">5-7-5</span>
                  </button>

                  <button class="form-card" (click)="loadFormExample('tanka')">
                    <span class="form-name">tanka</span>
                    <span class="form-pattern">5-7-5-7-7</span>
                  </button>

                  <button class="form-card" (click)="loadFormExample('limerick')">
                    <span class="form-name">limerick</span>
                    <span class="form-pattern">8-8-5-5-8</span>
                  </button>

                  <button class="form-card" (click)="loadFormExample('cinquain')">
                    <span class="form-name">cinquain</span>
                    <span class="form-pattern">2-4-6-8-2</span>
                  </button>
                </div>
              </div>
            </div>
          </app-card>
        }
      </div>
    </div>
  </app-panorama>

  <app-footer />

  <app-appbar
    class="lg:hidden"
    [actions]="appBarActionsValue"
    (actionClick)="onAppBarAction($event)"
  />
</div>