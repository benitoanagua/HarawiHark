<article class="page-container">
  <app-header />

  <section class="page-content">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="hero-icon-container">
        <span class="icon-[iconoir--flower] hero-icon"></span>
        <h1 class="hero-title">harawihark</h1>
      </div>
      <p class="hero-subtitle">
        advanced syllable-meter checker with AI-powered suggestions
      </p>
    </div>

    <!-- Editor Section -->
    <div class="editor-section">
      <app-poem-editor />
    </div>

    <!-- Generation Actions (only show when no analysis result) -->
    <div class="generation-actions" *ngIf="!analyzer.result()">
      <div class="actions-grid">
        <app-button
          variant="secondary"
          size="medium"
          label="generate poem"
          icon="icon-[iconoir--magic-wand]"
          (clicked)="onGeneratePoem()"
          [disabled]="analyzer.isLoading()"
        />
        
        <app-button
          variant="outline"
          size="medium"
          label="use template"
          icon="icon-[iconoir--page]"
          (clicked)="analyzer.loadExample()"
        />
      </div>
    </div>

    <!-- Generated Poem Section -->
    @if (analyzer.generatedPoem(); as generated) {
      <div class="generated-section">
        <app-card padding="large">
          <div class="generated-container">
            <h3 class="generated-title">generated poem</h3>
            <div class="generated-poem">
              @for (line of generated; track $index) {
                <p class="generated-line">{{ line }}</p>
              }
            </div>
            <div class="generated-actions">
              <app-button
                variant="primary"
                size="small"
                label="use this poem"
                icon="icon-[iconoir--check]"
                (clicked)="onUseGeneratedPoem()"
              />
              <app-button
                variant="outline"
                size="small"
                label="generate another"
                icon="icon-[iconoir--refresh]"
                (clicked)="onGeneratePoem()"
              />
            </div>
          </div>
        </app-card>
      </div>
    }

    <!-- Word Suggestions Section -->
    @if (analyzer.wordAlternatives(); as alternatives) {
      <div class="suggestions-section">
        <app-word-suggestions
          [data]="alternatives"
          (replaceWord)="onReplaceWord($event)"
          (closeSuggestions)="onCloseSuggestions()"
        />
      </div>
    }

    <!-- Main Results Section -->
    @if (analyzer.result(); as result) {
      <div class="results-section">
        <app-poem-results
          [result]="result"
          (wordSelected)="onWordSelected($event)"
        />

        <!-- Quick Stats -->
        <div class="quick-stats">
          <app-card padding="small">
            <div class="stats-container">
              @let stats = getQuickStats();
              <div class="stat-item">
                <span class="stat-label">total syllables</span>
                <span class="stat-value">{{ stats.totalSyllables }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">avg per line</span>
                <span class="stat-value">{{ stats.avgSyllablesPerLine }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">vocabulary</span>
                <span class="stat-value">{{ stats.vocabularyRichness }}%</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">completion</span>
                <span class="stat-value">
                  {{ analyzer.isCompletePoem() ? '✓' : '✗' }}
                </span>
              </div>
            </div>
          </app-card>
        </div>

        <!-- Advanced Actions -->
        <div class="advanced-actions">
          <div class="actions-row">
            <app-button
              variant="secondary"
              size="medium"
              label="assess quality"
              icon="icon-[iconoir--star]"
              (clicked)="onAssessQuality()"
            />
            
            <app-button
              variant="outline"
              size="medium"
              label="analyze rhythm"
              icon="icon-[iconoir--music-double]"
              (clicked)="onShowMeterAnalysis()"
            />
            
            <app-button
              variant="outline"
              size="medium"
              label="generate variations"
              icon="icon-[iconoir--view-grid]"
              (clicked)="onGenerateVariations()"
              [disabled]="analyzer.isLoading()"
            />
            
            <app-button
              variant="outline"
              size="medium"
              label="export poem"
              icon="icon-[iconoir--cloud-download]"
              (clicked)="onExportPoem()"
            />
          </div>
        </div>

        <!-- Quality Assessment Section -->
        @if (showQuality() && analyzer.qualityMetrics()) {
          <div class="quality-section">
            <app-poem-quality [metrics]="analyzer.qualityMetrics()!" />
          </div>
        }

        <!-- Meter Analysis Section -->
        @if (showMeterAnalysis() && analyzer.result()?.meterAnalysis) {
          <div class="meter-analysis-section">
            <app-card padding="large">
              <div class="meter-analysis-container">
                <h3 class="section-title">rhythm & meter analysis</h3>
                
                @if (analyzer.result()?.meterAnalysis; as meter) {
                  <div class="meter-info">
                    <div class="meter-header">
                      <app-badge 
                        [variant]="meter.consistency > 70 ? 'success' : meter.consistency > 40 ? 'warning' : 'error'"
                        size="medium"
                        icon="icon-[iconoir--music-double]"
                      >
                        {{ meter.type }} meter
                      </app-badge>
                      <span class="consistency-score">
                        {{ meter.consistency.toFixed(0) }}% consistent
                      </span>
                    </div>
                    
                    <p class="meter-pattern">{{ meter.pattern }}</p>
                    <p class="meter-description">{{ meter.description }}</p>
                    
                    @if (meter.examples.length > 0) {
                      <div class="meter-examples">
                        <h4>examples of {{ meter.type }} meter:</h4>
                        <ul class="examples-list">
                          @for (example of meter.examples; track $index) {
                            <li class="example-item">{{ example }}</li>
                          }
                        </ul>
                      </div>
                    }
                  </div>
                }
                
                @if (analyzer.rhythmSuggestions().length > 0) {
                  <div class="rhythm-suggestions">
                    <h4 class="suggestions-title">rhythm suggestions</h4>
                    <div class="suggestions-list">
                      @for (suggestion of analyzer.rhythmSuggestions(); track $index) {
                        <div class="suggestion-item">
                          <span class="line-number">Line {{ suggestion.line }}</span>
                          <div class="suggestion-content">
                            <p class="suggestion-issue">{{ suggestion.issue }}</p>
                            <p class="suggestion-text">{{ suggestion.suggestion }}</p>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                } @else {
                  <div class="no-rhythm-suggestions">
                    <span class="icon-[iconoir--check] no-suggestions-icon"></span>
                    <p class="no-suggestions-text">Great rhythm consistency! No suggestions needed.</p>
                  </div>
                }
              </div>
            </app-card>
          </div>
        }

        <!-- Poem Variations Section -->
        @if (showVariations() && analyzer.poemVariations().length > 0) {
          <div class="variations-section">
            <app-card padding="large">
              <div class="variations-container">
                <h3 class="variations-title">poem variations</h3>
                <div class="variations-grid">
                  @for (lineVariations of analyzer.poemVariations(); track $index; let i = $index) {
                    <div class="line-variations">
                      <h4 class="line-title">
                        line {{ i + 1 }} alternatives
                        <span class="original-syllables">
                          ({{ analyzer.result()!.lines[i].expected }} syllables)
                        </span>
                      </h4>
                      <div class="variation-list">
                        @for (variation of lineVariations; track $index) {
                          <div class="variation-item">
                            <span class="variation-text">{{ variation }}</span>
                            <app-button
                              variant="outline"
                              size="small"
                              label="use"
                              (clicked)="onUseVariation(i, variation)"
                            />
                          </div>
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>
            </app-card>
          </div>
        }
      </div>
    } @else {
      <!-- Empty State -->
      <div class="empty-state-section">
        <app-card padding="large">
          <div class="empty-content">
            <span class="icon-[iconoir--flower] empty-icon"></span>
            <h3 class="empty-title">ready to analyze</h3>
            <p class="empty-description">
              Write your poem or generate one to see syllable analysis and suggestions
            </p>
            <div class="empty-actions">
              <app-button
                variant="primary"
                size="medium"
                label="try an example"
                icon="icon-[iconoir--page]"
                (clicked)="analyzer.loadExample()"
              />
            </div>
          </div>
        </app-card>
      </div>
    }

    <!-- Info Section -->
    <div class="info-section">
      <div class="info-content">
        <span class="icon-[iconoir--light-bulb] info-icon"></span>
        <div class="info-text">
          <h4 class="info-title">how it works</h4>
          <p class="info-description">
            Harawihark uses advanced phonetic analysis to count syllables accurately, 
            detect rhyme schemes, and provide intelligent suggestions for improving your poetry.
          </p>
          <ul class="info-features">
            <li>
              <span class="icon-[iconoir--sound-high] feature-icon"></span>
              Real-time syllable counting with RiTa.js
            </li>
            <li>
              <span class="icon-[iconoir--music-double] feature-icon"></span>
              Advanced meter analysis (iambic, trochaic, etc.)
            </li>
            <li>
              <span class="icon-[iconoir--magic-wand] feature-icon"></span>
              AI-powered word suggestions and variations
            </li>
            <li>
              <span class="icon-[iconoir--star] feature-icon"></span>
              Quality assessment with detailed metrics
            </li>
            <li>
              <span class="icon-[iconoir--book-stack] feature-icon"></span>
              8 different poetic forms supported
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

    <app-footer />

</article>